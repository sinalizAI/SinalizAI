<SignsDetectionScreen>:
    name: 'signs_detection'
    
    # Layout principal sobre a câmera
    FloatLayout:
        id: camera_display
        size: root.size
        pos: root.pos
        # Status (canto inferior esquerdo) - apenas para debug
        MDLabel:
            id: status_label
            text: "Preparando câmera..."
            size_hint: None, None
            size: self.texture_size
            pos_hint: {"x": 0.05, "y": 0.02}
            theme_text_color: "Custom"
            text_color: 1, 1, 1, 0.5  # Branco bem transparente
            font_size: "10sp"

    # Camada de feedback SEMPRE POR CIMA
    FloatLayout:
        size: root.size
        pos: root.pos
        # FEEDBACK VISUAL PRINCIPAL - canto superior esquerdo
        MDLabel:
            id: feedback_label
            text: "Pressione REC para gravar"
            size_hint_x: None
            size_hint_y: None
            width: 400
            height: self.texture_size[1] + 20
            pos_hint: {"x": 0.02, "top": 0.98}
            theme_text_color: "Custom"
            text_color: 1, 1, 1, 1  # Branco sólido
            font_size: "24sp"
            bold: True
            halign: "left"
            valign: "top"
            text_size: self.width, None
            canvas.before:
                Color:
                    rgba: 0.2, 0.4, 0.8, 0.8  # Azul semi-transparente
                RoundedRectangle:
                    pos: self.x, self.y
                    size: self.width, self.height
                    radius: [10]

    # Camada de resultado lateral SEMPRE POR CIMA DE TUDO
    FloatLayout:
        size: root.size
        pos: root.pos
        MDLabel:
            id: side_result_label
            text: ""
            size_hint_x: None
            size_hint_y: None
            width: 320
            height: self.texture_size[1] + 20
            pos_hint: {"x": 0.36, "top": 0.98}
            theme_text_color: "Custom"
            text_color: 0, 1, 0, 1  # Verde
            font_size: "22sp"
            bold: True
            halign: "left"
            valign: "top"
            text_size: self.width, None
            opacity: 0  # Inicialmente invisível
            canvas.before:
                Color:
                    rgba: 0, 0.4, 0, 0.7  # Verde escuro semi-transparente
                RoundedRectangle:
                    pos: self.x, self.y
                    size: self.width, self.height
                    radius: [10]
        # RESULTADO GRANDE - centro da tela
        MDLabel:
            id: result_label
            text: ""
            size_hint: None, None
            size: self.texture_size
            pos_hint: {"center_x": 0.5, "center_y": 0.5}
            theme_text_color: "Custom"
            text_color: 0, 1, 0, 1  # Verde
            font_size: "36sp"
            bold: True
            halign: "center"
            opacity: 0  # Inicialmente invisível
            canvas.before:
                Color:
                    rgba: 0, 0, 0, 0.7  # Preto semi-transparente
                RoundedRectangle:
                    pos: self.x - 30, self.y - 20
                    size: self.width + 60, self.height + 40
                    radius: [15]

    # Botão X SEMPRE POR CIMA - igual ao detection.kv
    RelativeLayout:
        size: root.size
        pos: root.pos
        
        Button:
            id: close_button
            text: "X"
            size_hint: None, None
            size: "60dp", "60dp"
            pos_hint: {"right": 0.95, "top": 0.95}
            background_color: 1, 1, 1, 1  # Fundo branco sólido
            color: 0, 0, 0, 1  # Texto preto
            font_size: "24sp"
            bold: True
            # Design simples e limpo - quadrado branco
            canvas.before:
                Color:
                    rgba: 1, 1, 1, 1  # Fundo branco
                Rectangle:
                    pos: self.pos
                    size: self.size
                Color:
                    rgba: 0, 0, 0, 1  # Borda preta
                Line:
                    rectangle: (self.x, self.y, self.width, self.height)
                    width: 2
            on_release: root.go_back()
            
        # Botão de gravação manual (canto inferior direito)
        Button:
            id: record_button
            text: "REC"
            size_hint: None, None
            size: "80dp", "50dp"
            pos_hint: {"right": 0.95, "y": 0.05}
            background_color: 1, 0, 0, 0.8  # Vermelho semi-transparente
            color: 1, 1, 1, 1  # Texto branco
            font_size: "16sp"
            bold: True
            canvas.before:
                Color:
                    rgba: 1, 0, 0, 0.8  # Fundo vermelho
                Rectangle:
                    pos: self.pos
                    size: self.size
                Color:
                    rgba: 1, 1, 1, 1  # Borda branca
                Line:
                    rectangle: (self.x, self.y, self.width, self.height)
                    width: 2
            on_release: root.start_manual_recording()
            
    # Card de instruções flutuante (inicialmente visível)
    MDCard:
        id: instruction_card
        size_hint: None, None
        size: "300dp", "200dp"
        pos_hint: {"center_x": 0.5, "center_y": 0.3}
        md_bg_color: 1, 1, 1, 0.95
        elevation: 8
        radius: [10]
        
        MDBoxLayout:
            orientation: 'vertical'
            padding: "20dp"
            spacing: "10dp"
            
            MDLabel:
                text: "Como usar:"
                font_style: "Subtitle1"
                theme_text_color: "Primary"
                bold: True
                size_hint_y: None
                height: "30dp"
                halign: "center"
                
            MDLabel:
                text: "• Posicione-se na frente da câmera\n• Faça o sinal com as mãos\n• O sistema detectará automaticamente\n• Aguarde 4 segundos para gravação"
                font_style: "Body2"
                theme_text_color: "Secondary"
                text_size: self.width - dp(40), None
                valign: "center"
                halign: "center"
                
            MDRaisedButton:
                text: "ENTENDI"
                size_hint: None, None
                size: "120dp", "40dp"
                pos_hint: {"center_x": 0.5}
                on_release: root.hide_instructions()